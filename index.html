<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Clock</title>
    <link rel="stylesheet" href="styles.css">

    <script>
        function initialize() {
            setNextUpdate();
            updateDateTime();
        }

        function updateDateTime() {
            // Get the time
            var today = new Date();
            var hours = today.getHours();
            if (hours > 12) hours -= 12;
            var minutes = today.getMinutes();
            var seconds = today.getSeconds();
            minutes = addLeadingZero(minutes);
            seconds = addLeadingZero(seconds);

            // Get the date
            weekday = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
            dayOfWeek = weekday[today.getDay()];
            dayOfMonth = addOrdinalSuffix(today.getDate());
            months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
            month = months[today.getMonth()];
            year = today.getFullYear();
            meridian = today.getHours() > 12 ? "PM" : "AM";

            // Update the page
            document.getElementById('time').innerHTML = hours + ":" + minutes + ":" + seconds;
            document.getElementById('date').innerHTML = dayOfWeek + ", " + month + ' ' + dayOfMonth + ' ' + year;

            // Set it up to update every 500 ms
            var t = setTimeout(updateDateTime, 500);

            if (timeToUpdate()) {
                setNextUpdate();
                reload();
            }
        }

        function addLeadingZero(i) {
            if (i < 10) { i = "0" + i };
            return i;
        }

        function addOrdinalSuffix(i) {
            var j = i % 10,
                k = i % 100;
            if (j == 1 && k != 11) {
                return i + "st";
            }
            if (j == 2 && k != 12) {
                return i + "nd";
            }
            if (j == 3 && k != 13) {
                return i + "rd";
            }
            return i + "th";
        }

        function timeToUpdate() {
            var nextUpdate = new Date(sessionStorage.getItem("nextUpdate"));
            return new Date() > nextUpdate;
        }

        function setNextUpdate() {
            var now = new Date();
            
            if (now.getMinutes() > 30) {
                now.setHours(now.getHours() + 1)
                now.setMinutes(0);
                now.setSeconds(0);
            }
            else {
                now.setMinutes(30);
                now.setSeconds(0);
            }
            
            sessionStorage.setItem("nextUpdate", now);
        }

        function reload() {
            window.location.reload();
        }
    </script>

</head>

<body onload="initialize()">

    <table id="table" class="table">
        <tbody>
            <tr>
                <div class="time" id="time"></div>
            </tr>
            <tr>
                <div class="date" id="date"></div>
            </tr>
        </tbody>
    </table>

</body>

</html>